<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KNS G-NOC-SOC | Command Center</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* --- TEMA NEON DARK (KNS BRAND) --- */
:root {
    --bg-color: #050a14;
    --glass-bg: rgba(20, 30, 50, 0.6);
    --glass-border: rgba(59, 130, 246, 0.2);
    --text-main: #e2e8f0;
    --text-muted: #94a3b8;
    --neon-blue: #3b82f6;
    --neon-green: #10b981;
    --neon-red: #ef4444;
    --card-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
}

* { box-sizing: border-box; transition: all 0.3s ease; }
body {
    margin: 0; padding: 15px; background: var(--bg-color);
    background-image: radial-gradient(#1e293b 1px, transparent 1px); background-size: 30px 30px;
    color: var(--text-main); font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden;
}

/* --- GRID LAYOUT --- */
.dashboard-grid {
    display: grid; grid-template-columns: 280px 1fr; grid-template-rows: auto 1fr auto;
    gap: 15px; height: calc(100vh - 30px);
}

.header {
    grid-column: 1 / -1; display: flex; justify-content: space-between; align-items: center;
    border-bottom: 1px solid var(--glass-border); padding-bottom: 10px;
}
.brand h1 { font-family: 'JetBrains Mono'; font-size: 24px; margin: 0; letter-spacing: -2px; }
.brand span { color: var(--neon-blue); text-shadow: 0 0 10px var(--neon-blue); }

/* --- CARDS & ALERTA DE SATURAÇÃO --- */
.glass-card {
    background: var(--glass-bg); backdrop-filter: blur(8px); border: 1px solid var(--glass-border);
    border-radius: 12px; padding: 15px; display: flex; flex-direction: column; position: relative;
    box-shadow: var(--card-shadow);
}

.alert-blink {
    animation: critical-pulse 0.5s infinite alternate !important;
    border: 2px solid var(--neon-red) !important;
    background: rgba(239, 68, 68, 0.1) !important;
}

@keyframes critical-pulse {
    from { box-shadow: 0 0 5px var(--neon-red); }
    to { box-shadow: 0 0 25px var(--neon-red); }
}

/* --- SIDEBAR & METRICS --- */
.sidebar { display: flex; flex-direction: column; gap: 10px; grid-row: 2 / 3; }
.metric-val { font-family: 'JetBrains Mono'; font-size: 28px; font-weight: 700; margin-top: 5px; }

/* --- CHARTS --- */
.main-stage { 
    grid-column: 2 / 3; grid-row: 2 / 3; display: grid; 
    grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); gap: 10px; 
}
.chart-title { position: absolute; top: 10px; left: 15px; font-size: 10px; color: var(--text-muted); text-transform: uppercase; z-index: 2;}

.fake-chart { display: flex; align-items: flex-end; justify-content: space-between; gap: 2px; height: 100%; padding-top: 30px; opacity: 0.7; }
.bar { flex: 1; background: var(--neon-blue); opacity: 0.5; animation: equalizer 1s infinite alternate; }

/* --- LOGS --- */
.logs-panel { grid-column: 1 / -1; height: 120px; font-family: 'JetBrains Mono'; font-size: 11px; overflow-y: auto; }
.log-line { border-bottom: 1px solid rgba(255,255,255,0.05); padding: 2px 0; color: var(--neon-blue); }

/* --- ATACK MODE --- */
@keyframes shake { 0% { transform: translate(1px, 1px); } 100% { transform: translate(-1px, -1px); } }
.attack-mode .glass-card { border-color: var(--neon-red); animation: shake 0.5s infinite; }
.attack-mode .brand span { color: var(--neon-red); text-shadow: 0 0 15px red; }
.attack-mode .bar { background: var(--neon-red) !important; }
</style>
</head>
<body>

<div class="dashboard-grid">
    <div class="header">
        <div class="brand"><h1>KNS<span>_COMMAND_CENTER</span></h1></div>
        <div class="controls" style="display:flex; gap:15px; align-items:center;">
            <div style="font-size:12px"><span id="sys-dot" style="height:10px; width:10px; background:var(--neon-green); border-radius:50%; display:inline-block;"></span> <span id="sys-status">ONLINE</span></div>
            <button onclick="toggleAttack()" id="btn-attack" style="background:transparent; border:1px solid var(--neon-red); color:var(--neon-red); padding:5px 15px; border-radius:4px; cursor:pointer; font-weight:bold;">
                <i class="fa-solid fa-bug"></i> SIMULAR ATAQUE
            </button>
        </div>
    </div>

    <aside class="sidebar">
        <div class="glass-card">
            <small style="color:var(--text-muted)">LATÊNCIA (LATAM)</small>
            <div class="metric-val" id="lat-val" style="color:var(--neon-green)">--ms</div>
        </div>
        <div class="glass-card" id="card-traffic">
            <small style="color:var(--text-muted)">TRÁFEGO (WI-FI 10777)</small>
            <div class="metric-val" id="rps-val">-- Mbps</div>
        </div>
        <div class="glass-card">
            <small style="color:var(--text-muted)">CPU LOAD</small>
            <div class="metric-val" id="cpu-val">--%</div>
            <div style="width:100%; height:4px; background:#333; margin-top:5px;"><div id="cpu-bar" style="width:0%; height:100%; background:var(--neon-blue)"></div></div>
        </div>
    </aside>

    <main class="main-stage">
        <div class="glass-card chart-box">
            <span class="chart-title">Tráfego de Entrada (Live)</span>
            <div class="fake-chart">
                <script>for(let i=0; i<15; i++) document.write(`<div class="bar" style="height:${Math.random()*80+10}%"></div>`);</script>
            </div>
        </div>
        <div class="glass-card chart-box">
            <span class="chart-title">Mitigação de Ameaças</span>
            <div class="fake-chart">
                <script>for(let i=0; i<15; i++) document.write(`<div class="bar" style="height:${Math.random()*40+10}%"></div>`);</script>
            </div>
        </div>
        <div class="glass-card chart-box" style="grid-column: span 2;">
            <span class="chart-title">Monitoramento Global de Infraestrutura</span>
             <div class="fake-chart">
                <script>for(let i=0; i<45; i++) document.write(`<div class="bar" style="height:${Math.random()*100}%; animation-delay:-${Math.random()}s"></div>`);</script>
            </div>
        </div>
    </main>

    <footer class="glass-card logs-panel" id="log-panel">
        <div class="log-line">[SYS] Initializing Protocol 09 Command Center...</div>
    </footer>
</div>

<script>
    let isAttack = false;

    function updateDashboard() {
        fetch('/api/enterprise-status')
            .then(res => res.json())
            .then(data => {
                document.getElementById('cpu-val').innerText = data.system.cpu + "%";
                document.getElementById('cpu-bar').style.width = data.system.cpu + "%";
                
                const traffic = data.business.rps;
                document.getElementById('rps-val').innerText = traffic + " Mbps";

                // Feedback visual de saturação real do Zabbix
                const card = document.getElementById('card-traffic');
                if (traffic > 50) {
                    card.classList.add('alert-blink');
                    if(!isAttack) addLog("WARN", `Interface threshold exceeded: ${traffic} Mbps`);
                } else {
                    card.classList.remove('alert-blink');
                }

                document.getElementById('lat-val').innerText = data.regions.latam.ms + "ms";
                document.getElementById('lat-val').style.color = data.regions.latam.status === 'BAD' ? 'var(--neon-red)' : 'var(--neon-green)';

                if (data.business.is_under_attack !== isAttack) applyAttackVisuals(data.business.is_under_attack);
            }).catch(err => console.warn("Waiting for server sync..."));
    }

    function applyAttackVisuals(active) {
        isAttack = active;
        document.body.classList.toggle('attack-mode', active);
        const btn = document.getElementById('btn-attack');
        const status = document.getElementById('sys-status');
        const dot = document.getElementById('sys-dot');

        btn.innerText = active ? "MITIGAR AGORA" : "SIMULARE ATAQUE";
        btn.style.background = active ? "var(--neon-red)" : "transparent";
        btn.style.color = active ? "white" : "var(--neon-red)";
        status.innerText = active ? "UNDER ATTACK" : "ONLINE";
        status.style.color = active ? "var(--neon-red)" : "var(--text-main)";
        dot.style.background = active ? "red" : "var(--neon-green)";
    }

    function toggleAttack() {
        fetch('/api/actions', { 
            method: 'POST', 
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ action: isAttack ? 'MITIGATE_DDOS' : 'SIMULATE_ATTACK' })
        }).then(res => res.json()).then(data => {
            applyAttackVisuals(data.newState.isUnderAttack);
            addLog(isAttack ? "CRIT" : "SYS", isAttack ? "Invasion simulation triggered." : "Defenses normalized.");
        });
    }

    function addLog(lvl, msg) {
        const p = document.getElementById('log-panel');
        const div = document.createElement('div');
        div.className = 'log-line';
        div.innerHTML = `<span style="opacity:0.5">${new Date().toLocaleTimeString()}</span> [${lvl}] ${msg}`;
        p.prepend(div);
        if (p.childNodes.length > 50) p.removeChild(p.lastChild);
    }

    setInterval(updateDashboard, 2000);
</script>
</body>
</html>