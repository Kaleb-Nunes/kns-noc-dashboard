<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KNS | NEXT-GEN OPS</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* --- ESTÉTICA CYBERPUNK --- */
:root {
    --bg-dark: #030507;
    --neon-cyan: #00f3ff;
    --neon-pink: #ff0055;
    --neon-green: #0aff00;
    --glass: rgba(10, 20, 30, 0.6);
}

* { box-sizing: border-box; transition: all 0.3s ease; }

body {
    margin: 0; padding: 20px;
    background-color: var(--bg-dark);
    color: #fff;
    font-family: 'Rajdhani', sans-serif;
    height: 100vh; overflow: hidden;
    /* Fundo Tecnológico */
    background-image: 
        linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
    background-size: 30px 30px;
}

/* Scanlines CRT */
body::after {
    content: " "; display: block; position: absolute;
    top: 0; left: 0; bottom: 0; right: 0;
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
    background-size: 100% 4px; z-index: 999; pointer-events: none; opacity: 0.3;
}

/* --- LAYOUT --- */
.cyber-grid {
    display: grid;
    grid-template-columns: 320px 1fr;
    grid-template-rows: 70px 1fr 120px;
    gap: 20px;
    height: calc(100vh - 40px);
    position: relative; z-index: 2;
}

/* --- HEADER --- */
.header {
    grid-column: 1 / -1;
    display: flex; justify-content: space-between; align-items: center;
    border-bottom: 2px solid var(--neon-cyan);
    background: linear-gradient(90deg, rgba(0,243,255,0.1), transparent);
    padding: 0 20px;
    text-transform: uppercase;
}
.logo { font-family: 'Orbitron'; font-size: 32px; font-weight: 900; letter-spacing: 2px; text-shadow: 0 0 15px var(--neon-cyan); }
.logo span { color: var(--neon-cyan); }

.top-controls { display: flex; gap: 30px; align-items: center; }
.sys-info { display: flex; gap: 20px; font-size: 14px; font-weight: bold; color: var(--neon-green); text-shadow: 0 0 5px var(--neon-green); }
.lang-flags img { width: 30px; cursor: pointer; opacity: 0.6; margin-left: 10px; transition: 0.2s; }
.lang-flags img:hover, .lang-flags img.active { opacity: 1; transform: scale(1.1); box-shadow: 0 0 10px var(--neon-cyan); }

/* --- SIDEBAR --- */
.sidebar { grid-row: 2 / 3; display: flex; flex-direction: column; gap: 20px; }

.cyber-card {
    background: var(--glass);
    border: 1px solid rgba(0, 243, 255, 0.3);
    padding: 20px; position: relative;
    backdrop-filter: blur(5px);
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
}
.cyber-card::before {
    content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%;
    background: var(--neon-cyan); box-shadow: 0 0 10px var(--neon-cyan);
}

.metric-title { font-size: 14px; color: var(--neon-cyan); letter-spacing: 2px; margin-bottom: 5px; display: block; font-weight: 700; }
.metric-big { font-family: 'Orbitron'; font-size: 42px; color: #fff; }
.unit { font-size: 16px; color: #888; }

/* Status de Segurança */
.sec-box { text-align: center; padding: 25px 0; border: 2px dashed var(--neon-green); margin-top: 15px; transition: all 0.3s; background: rgba(0, 255, 0, 0.05); }
.sec-text { font-family: 'Orbitron'; font-size: 22px; color: var(--neon-green); font-weight: 900; text-shadow: 0 0 10px var(--neon-green); }

/* Botão de Mitigação (Oculto por padrão) */
.btn-mitigate {
    display: none; width: 100%; margin-top: 15px;
    background: var(--neon-red); border: none; color: #fff;
    padding: 15px; font-weight: bold; font-family: 'Orbitron'; font-size: 14px;
    cursor: pointer; text-transform: uppercase; letter-spacing: 1px;
    box-shadow: 0 0 20px var(--neon-red);
    animation: pulse 0.5s infinite alternate;
}
.btn-mitigate:hover { background: #fff; color: var(--neon-red); }

/* --- MAIN STAGE (GRAFANA) --- */
.main-stage {
    grid-column: 2 / 3; grid-row: 2 / 3;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: 60% 40%;
    gap: 20px;
}
.grafana-frame { width: 100%; height: 100%; border: 0; opacity: 0.9; filter: contrast(1.1) brightness(1.1) saturate(1.2); }
.g-large-1 { grid-column: span 2; }
.g-large-2 { grid-column: span 1; }
.g-small { grid-column: span 1; }

/* --- FOOTER LOGS --- */
.footer {
    grid-column: 1 / -1;
    background: #000; border-top: 2px solid var(--neon-cyan);
    font-family: 'Courier New', monospace; font-size: 13px;
    padding: 15px; overflow-y: hidden; color: var(--neon-cyan);
    display: flex; flex-direction: column; justify-content: flex-end;
}
.log-line { margin-bottom: 4px; border-bottom: 1px solid rgba(0, 243, 255, 0.1); padding-bottom: 2px; }
.t-stamp { color: #555; margin-right: 15px; }

/* --- MODO ATAQUE --- */
.alert-mode .cyber-card { border-color: var(--neon-red); }
.alert-mode .cyber-card::before { background: var(--neon-red); box-shadow: 0 0 20px var(--neon-red); }
.alert-mode .sec-box { border-color: var(--neon-red); background: rgba(255, 0, 0, 0.1); animation: shake 0.5s infinite; }
.alert-mode .sec-text { color: var(--neon-red); text-shadow: 0 0 20px var(--neon-red); animation: blink 0.2s infinite; }
.alert-mode .header { border-bottom-color: var(--neon-red); }
.alert-mode .logo span { color: var(--neon-red); }
.alert-mode .footer { border-top-color: var(--neon-red); color: var(--neon-red); }

@keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
@keyframes pulse { from { transform: scale(1); } to { transform: scale(1.03); } }
@keyframes shake { 0% { transform: translate(1px, 1px); } 25% { transform: translate(-1px, -2px); } 50% { transform: translate(-3px, 0px); } 75% { transform: translate(3px, 2px); } 100% { transform: translate(1px, -1px); } }

</style>
</head>
<body>

<div class="cyber-grid">
    <div class="header">
        <div class="logo">KNS <span>// COMMAND_NODE</span></div>
        <div class="top-controls">
            <div class="sys-info">
                <div id="lbl-server"><i class="fa-solid fa-server"></i> SERVER: ONLINE</div>
                <div id="lbl-firewall"><i class="fa-solid fa-shield-halved"></i> FIREWALL: ACTIVE</div>
                <div style="cursor:pointer; color:var(--neon-pink); font-weight:900" onclick="triggerChaos()" id="lbl-sim">[ SIMULAR INVASÃO ]</div>
            </div>
            <div class="lang-flags">
                <img src="https://flagcdn.com/w40/br.png" class="active" onclick="setLang('pt')" id="flag-pt">
                <img src="https://flagcdn.com/w40/us.png" onclick="setLang('en')" id="flag-en">
            </div>
        </div>
    </div>

    <div class="sidebar">
        <div class="cyber-card">
            <span class="metric-title" id="t-net">CARGA DE REDE (GLOBAL)</span>
            <span class="metric-big" id="net-load">1.2</span> <span class="unit">Tbps</span>
            <div style="height:4px; width:100%; background:#222; margin-top:10px;"><div id="bar-load" style="height:100%; width:45%; background:var(--neon-cyan); box-shadow:0 0 10px var(--neon-cyan)"></div></div>
        </div>

        <div class="cyber-card">
            <span class="metric-title" id="t-nodes">NODES ATIVOS</span>
            <span class="metric-big">4,829</span>
        </div>

        <div class="cyber-card">
            <span class="metric-title" id="t-threat">NÍVEL DE AMEAÇA</span>
            <div class="sec-box">
                <div class="sec-text" id="sec-status">SEGURO</div>
            </div>
            <button onclick="mitigate()" class="btn-mitigate" id="btn-mitigate">INICIAR PROTOCOLO 9</button>
        </div>
    </div>

    <div class="main-stage">
        <div class="cyber-card g-large-1" style="padding:0; overflow:hidden">
            <iframe class="grafana-frame" src="http://localhost:3000/d-solo/adlvx49/kns-monitor?orgId=1&from=now-5m&to=now&timezone=browser&refresh=2s&panelId=4&__feature.dashboardSceneSolo=true&theme=dark" frameborder="0"></iframe>
        </div>

        <div class="cyber-card g-large-2" style="padding:0; overflow:hidden">
            <iframe class="grafana-frame" src="http://localhost:3000/d-solo/adlvx49/kns-monitor?orgId=1&from=now-5m&to=now&timezone=browser&refresh=2s&panelId=2&__feature.dashboardSceneSolo=true&theme=dark" frameborder="0"></iframe>
        </div>

        <div class="cyber-card g-small" style="padding:0; overflow:hidden">
            <iframe class="grafana-frame" src="http://localhost:3000/d-solo/adlvx49/kns-monitor?orgId=1&from=now-5m&to=now&timezone=browser&refresh=2s&panelId=1&__feature.dashboardSceneSolo=true&theme=dark" frameborder="0"></iframe>
        </div>

        <div class="cyber-card g-small" style="padding:0; overflow:hidden">
            <iframe class="grafana-frame" src="http://localhost:3000/d-solo/adlvx49/kns-monitor?orgId=1&from=now-5m&to=now&timezone=browser&refresh=2s&panelId=3&__feature.dashboardSceneSolo=true&theme=dark" frameborder="0"></iframe>
        </div>

        <div class="cyber-card g-small" style="padding:0; overflow:hidden">
            <iframe class="grafana-frame" src="http://localhost:3000/d-solo/adlvx49/kns-monitor?orgId=1&from=now-5m&to=now&timezone=browser&refresh=2s&panelId=6&__feature.dashboardSceneSolo=true&theme=dark" frameborder="0"></iframe>
        </div>
    </div>

    <div class="footer" id="terminal-log">
        <div class="log-line"><span class="t-stamp">INIT</span> SYSTEM INITIALIZED. KNS MONITORING ACTIVE.</div>
    </div>
</div>

<script>
    // --- TRADUÇÕES ---
    const texts = {
        pt: {
            server: '<i class="fa-solid fa-server"></i> SERVIDOR: ONLINE',
            firewall: '<i class="fa-solid fa-shield-halved"></i> FIREWALL: ATIVO',
            sim: '[ SIMULAR INVASÃO ]',
            net: 'CARGA DE REDE (GLOBAL)',
            nodes: 'NODES ATIVOS',
            threat: 'NÍVEL DE AMEAÇA',
            secure: 'SEGURO',
            breach: 'INVASÃO CRÍTICA',
            mitigate: 'INICIAR PROTOCOLO 9',
            log_start: 'SISTEMA INICIADO. MONITORAMENTO ATIVO.',
            log_warn: 'TENTATIVA DE ACESSO BLOQUEADA.'
        },
        en: {
            server: '<i class="fa-solid fa-server"></i> SERVER: ONLINE',
            firewall: '<i class="fa-solid fa-shield-halved"></i> FIREWALL: ACTIVE',
            sim: '[ SIMULATE BREACH ]',
            net: 'NETWORK LOAD (GLOBAL)',
            nodes: 'ACTIVE NODES',
            threat: 'THREAT LEVEL',
            secure: 'SECURE',
            breach: 'CRITICAL BREACH',
            mitigate: 'INITIATE PROTOCOL 9',
            log_start: 'SYSTEM INITIALIZED. MONITORING ACTIVE.',
            log_warn: 'ACCESS ATTEMPT BLOCKED.'
        }
    };

    let curLang = 'pt';

    function setLang(lang) {
        curLang = lang;
        // Atualiza UI
        document.getElementById('flag-pt').className = lang === 'pt' ? 'active' : '';
        document.getElementById('flag-en').className = lang === 'en' ? 'active' : '';
        
        // Atualiza Textos
        const t = texts[lang];
        document.getElementById('lbl-server').innerHTML = t.server;
        document.getElementById('lbl-firewall').innerHTML = t.firewall;
        document.getElementById('lbl-sim').innerHTML = t.sim;
        document.getElementById('t-net').innerText = t.net;
        document.getElementById('t-nodes').innerText = t.nodes;
        document.getElementById('t-threat').innerText = t.threat;
        document.getElementById('btn-mitigate').innerText = t.mitigate;
        
        // Mantém status correto do ataque
        if(document.body.classList.contains('alert-mode')) {
             document.getElementById('sec-status').innerText = t.breach;
        } else {
             document.getElementById('sec-status').innerText = t.secure;
        }
    }

    function addLog(msg, type="INFO") {
        const term = document.getElementById('terminal-log');
        const line = document.createElement('div');
        line.className = 'log-line';
        const color = type === 'CRIT' ? '#ff0055' : (type === 'WARN' ? '#ffaa00' : '#00f3ff');
        line.innerHTML = `<span class="t-stamp">${new Date().toLocaleTimeString()}</span> <span style="color:${color}">[${type}]</span> ${msg}`;
        term.prepend(line);
        if(term.children.length > 8) term.removeChild(term.lastChild);
    }

    // --- MODO CAOS (ATAQUE) ---
    function triggerChaos() {
        document.body.classList.add('alert-mode');
        document.getElementById('sec-status').innerText = texts[curLang].breach;
        
        // MOSTRA O BOTÃO DE PARAR
        document.getElementById('btn-mitigate').style.display = 'block';
        
        addLog("UNAUTHORIZED ACCESS DETECTED ON PORT 443", "CRIT");
        addLog("DDOS SIGNATURE RECOGNIZED", "CRIT");
    }

    // --- FUNÇÃO REAL (FULL STACK): CHAMA O BACKEND PYTHON ---
    async function mitigate() {
        const btn = document.getElementById('btn-mitigate');
        
        // 1. Feedback visual imediato (UX)
        btn.innerText = curLang === 'pt' ? "EXECUTANDO PROTOCOLO..." : "EXECUTING PROTOCOL...";
        btn.style.opacity = "0.7";
        addLog(curLang === 'pt' ? "CONTATANDO SECURITY GATEWAY..." : "CONTACTING SECURITY GATEWAY...", "WARN");

        try {
            // 2. Chama a API Python (O Pulo do Gato)
            const response = await fetch('http://localhost:5001/api/mitigate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });

            const data = await response.json();

            if (data.status === 'success') {
                // 3. Se o Python confirmou, atualiza a tela
                document.body.classList.remove('alert-mode');
                
                // Atualiza textos
                document.getElementById('sec-status').innerText = texts[curLang].secure;

                // Some com o botão
                btn.style.display = 'none';
                
                // Adiciona log com a mensagem real do servidor
                addLog(`SERVER CONFIRMATION: ${data.action}`, "SYS");
                addLog(curLang === 'pt' ? "AMEAÇA NEUTRALIZADA. SISTEMAS ESTABILIZANDO." : "THREAT NEUTRALIZED. SYSTEMS STABILIZING.", "INFO");
            } else {
                addLog("ERROR EXECUTING PROTOCOL!", "CRIT");
            }

        } catch (error) {
            console.error(error);
            addLog("CONNECTION TO BACKEND FAILED. IS PYTHON RUNNING?", "CRIT");
            btn.innerText = "CONNECTION ERROR";
        }
    }

    // Simulação de fundo
    setInterval(() => {
        const load = (Math.random() * (1.8 - 0.8) + 0.8).toFixed(2);
        document.getElementById('net-load').innerText = load;
        document.getElementById('bar-load').style.width = (load * 30) + "%";
    }, 2000);

</script>
</body>
</html>